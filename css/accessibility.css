/* ========================================
   ACCESSIBILITY - Phase 5
   ========================================
   Focus management, keyboard navigation, screen reader support
   ======================================== */

/* ============ Skip to Main Content Link ============ */
.skip-link {
    position: absolute;
    top: -40px;
    left: 0;
    background: var(--primary);
    color: white;
    padding: 0.75rem 1.5rem;
    text-decoration: none;
    font-weight: 600;
    z-index: 10000;
    border-radius: 0 0 0.5rem 0;
}

.skip-link:focus {
    top: 0;
}

/* ============ Screen Reader Only ============ */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* ============ Focus Indicators ============ */
/* Enhanced focus visible for keyboard users */
body.using-keyboard *:focus {
    outline: 3px solid var(--primary, #2563eb);
    outline-offset: 2px;
}

body:not(.using-keyboard) *:focus {
    outline: none;
}

/* Specific focus styles for common elements */
body.using-keyboard button:focus,
body.using-keyboard a:focus,
body.using-keyboard input:focus,
body.using-keyboard select:focus,
body.using-keyboard textarea:focus {
    outline: 3px solid var(--primary, #2563eb);
    outline-offset: 2px;
    border-radius: 0.25rem;
}

/* Card focus */
body.using-keyboard .listing-card:focus-within {
    outline: 3px solid var(--primary);
    outline-offset: 4px;
}

/* ============ Keyboard Shortcuts Help Modal ============ */
.shortcuts-help-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 2rem;
    border-radius: 1rem;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
    max-width: 500px;
    width: 90%;
    z-index: 10001;
}

.shortcuts-help-modal h3 {
    margin-top: 0;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
}

.shortcuts-help-modal table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1.5rem;
}

.shortcuts-help-modal th,
.shortcuts-help-modal td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid #e5e7eb;
}

.shortcuts-help-modal th {
    background: #f9fafb;
    font-weight: 600;
}

.shortcuts-help-modal kbd {
    background: #f3f4f6;
    border: 1px solid #d1d5db;
    border-radius: 0.25rem;
    padding: 0.25rem 0.5rem;
    font-family: monospace;
    font-size: 0.875rem;
}

.shortcuts-help-modal button {
    width: 100%;
    padding: 0.75rem;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 0.5rem;
    font-weight: 600;
    cursor: pointer;
}

/* ============ Focus Trap Styling ============ */
.modal-overlay.active {
    /* Ensure focus trap works */
}

/* ============ High Contrast Mode Support ============ */
@media (prefers-contrast: high) {
    * {
        border-width: 2px !important;
    }

    .btn,
    button,
    a {
        border: 2px solid currentColor !important;
    }

    body.using-keyboard *:focus {
        outline-width: 4px !important;
    }
}

/* ============ Reduced Motion Support ============ */
@media (prefers-reduced-motion: reduce) {

    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
}

/* ============ ARIA Live Region ============ */
#aria-live-region {
    /* Already uses .sr-only class */
}

/* ============ Landmark Regions ============ */
main,
[role="main"] {
    /* Ensure main content is identifiable */
}

nav,
[role="navigation"] {
    /* Navigation landmarks */
}

/* ============ Form Accessibility ============ */
/* Required field indicator */
.required::after {
    content: " *";
    color: #dc2626;
    font-weight: 600;
}

/* Error messaging */
.form-error {
    color: #dc2626;
    font-size: 0.875rem;
    margin-top: 0.25rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.form-error::before {
    content: "⚠";
}

/* Success messaging */
.form-success {
    color: #16a34a;
    font-size: 0.875rem;
    margin-top: 0.25rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.form-success::before {
    content: "✓";
}

/* Invalid input styling */
input:invalid:not(:placeholder-shown),
textarea:invalid:not(:placeholder-shown),
select:invalid {
    border-color: #dc2626;
    background: #fef2f2;
}

input:valid:not(:placeholder-shown),
textarea:valid:not(:placeholder-shown),
select:valid {
    border-color: #16a34a;
}

/* ============ Button States ============ */
button:disabled,
.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

button[aria-pressed="true"] {
    background: var(--primary);
    color: white;
}

/* ============ Link Accessibility ============ */
a:not([class]) {
    /* Ensure links are underlined for visibility */
    text-decoration: underline;
}

a:focus-visible {
    outline: 3px solid var(--primary);
    outline-offset: 2px;
}

/* ============ Image Accessibility ============ */
img:not([alt]) {
    /* Warn about missing alt text in dev */
    border: 3px dashed #dc2626;
}

/* ============ Tab Order Optimization ============ */
/* Ensure logical tab order */
[tabindex="0"] {
    /* Focusable */
}

[tabindex="-1"] {
    /* Programmatically focusable only */
}

/* Don't use positive tabindex values - breaks natural order */

/* ============ Interactive Element States ============ */
/* Ensure all interactive elements have visible states */
button:hover:not(:disabled),
a:hover {
    opacity: 0.8;
}

button:active:not(:disabled),
a:active {
    opacity: 0.6;
}

/* ============ Color Contrast ============ */
/* Ensure minimum 4.5:1 contrast ratio for normal text */
/* Ensure minimum 3:1 contrast ratio for large text (18pt+) */

/* ============ Touch Target Size ============ */
/* Minimum 44x44px for touch targets (already in mobile-optimizations.css) */

/* ============ Print Styles ============ */
@media print {

    .skip-link,
    .bottom-navigation,
    .modal-overlay,
    .pull-to-refresh-indicator,
    button,
    .btn {
        display: none !important;
    }

    a[href]::after {
        content: " (" attr(href) ")";
    }
}

/* ============ Dark Mode Accessibility ============ */
@media (prefers-color-scheme: dark) {

    /* Ensure sufficient contrast in dark mode */
    .shortcuts-help-modal {
        background: #1f2937;
        color: #f9fafb;
    }

    .shortcuts-help-modal table th {
        background: #374151;
    }

    .shortcuts-help-modal kbd {
        background: #374151;
        border-color: #4b5563;
    }
}